# Example: Node.js/TypeScript project
#
# This is a PROJECT config (.rr.yaml) for a Node.js project using npm/yarn
# and Jest for testing.
#
# NOTE: Host definitions belong in your GLOBAL config (~/.rr/config.yaml).
# See global-config.yaml for an example global config.

version: 1

# Reference the host from your global config
# If omitted, all global hosts are available
host: dev-server

sync:
  exclude:
    - .git/
    - node_modules/
    - dist/
    - build/
    - coverage/
    - .next/
    - .nuxt/
    - "*.log"
    - .DS_Store
  preserve:
    # Keep node_modules on remote - npm install is slow
    - node_modules/

tasks:
  test:
    description: Run Jest tests
    run: npm test

  test-watch:
    description: Run tests in watch mode
    run: npm test -- --watch

  lint:
    description: Run ESLint
    run: npm run lint

  build:
    description: Build the project
    run: npm run build

  install:
    description: Install npm dependencies on remote
    run: npm ci

  dev:
    description: Start dev server
    run: npm run dev

  # Parallel tasks - run multiple checks simultaneously
  verify:
    description: Run all checks in parallel
    parallel:
      - test
      - lint
    fail_fast: false

  # Flake detection - run tests multiple times to find intermittent failures
  flake-check:
    description: Run tests 5x to detect flaky tests
    parallel:
      - test
      - test
      - test
      - test
      - test
    fail_fast: false

output:
  format: jest
  timing: true
