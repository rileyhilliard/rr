# Example: Python project with pytest
#
# This config is for a typical Python project that runs tests on a remote
# machine with more CPU/RAM than your laptop.

version: 1

hosts:
  build-box:
    ssh:
      - build.local          # Try local network first
      - build-tailscale      # Fall back to Tailscale
    dir: ${HOME}/projects/${PROJECT}
    env:
      PYTHONDONTWRITEBYTECODE: "1"

default: build-box

sync:
  exclude:
    - .git/
    - .venv/
    - __pycache__/
    - "*.pyc"
    - .mypy_cache/
    - .pytest_cache/
    - .ruff_cache/
    - .coverage
    - htmlcov/
    - dist/
    - "*.egg-info/"
  preserve:
    # Keep the remote venv - don't delete it on sync
    - .venv/

tasks:
  test:
    description: Run pytest with coverage
    run: .venv/bin/pytest tests/ -v --tb=short

  test-fast:
    description: Run tests without coverage
    run: .venv/bin/pytest tests/ -v --tb=short -x

  lint:
    description: Run ruff linter
    run: .venv/bin/ruff check .

  typecheck:
    description: Run mypy type checker
    run: .venv/bin/mypy src/

  install:
    description: Install dependencies in remote venv
    steps:
      - name: Create venv
        run: python3 -m venv .venv
      - name: Install deps
        run: .venv/bin/pip install -e ".[dev]"

output:
  format: pytest
  timing: true
