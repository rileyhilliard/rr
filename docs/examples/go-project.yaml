# Example: Go project
#
# This is a PROJECT config (.rr.yaml) for a Go project that builds and tests
# on a remote Linux machine (useful when developing on macOS but deploying to Linux).
#
# NOTE: Host definitions belong in your GLOBAL config (~/.rr/config.yaml).
# See global-config.yaml for an example global config.

version: 1

# Reference the host from your global config
# If omitted, all global hosts are available
host: linux-box

sync:
  exclude:
    - .git/
    - bin/
    - dist/
    - "*.exe"
    - vendor/  # If you vendor deps locally, exclude them
  preserve:
    # Go module cache lives elsewhere, nothing to preserve

tasks:
  test:
    description: Run all tests
    run: go test ./... -v

  test-race:
    description: Run tests with race detector
    run: go test ./... -race -v

  build:
    description: Build the binary
    run: go build -o bin/app ./cmd/app

  lint:
    description: Run golangci-lint
    run: golangci-lint run

  tidy:
    description: Tidy go.mod
    run: go mod tidy

  # Parallel tasks - run multiple checks simultaneously
  verify:
    description: Run all checks in parallel
    parallel:
      - test
      - lint
    fail_fast: false

  # Flake detection - run tests multiple times to find intermittent failures
  flake-check:
    description: Run tests 5x to detect flaky tests
    parallel:
      - test
      - test
      - test
      - test
      - test
    fail_fast: false

output:
  format: go
  timing: true
